---
params: 
    set_title: "Appendix A"
title: "`r params$set_title`"
author: "Sorenson Impact Center Data Science Team"
mainfont: Roboto
output:
  word_document:
      
    reference_docx: template/mystyles.docx
    fig_width: 6
    fig_height: 4
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Load packages 

library(siverse)
library(tidyverse)
library(tidycensus)

theme_set(theme_minimal())
theme_update(text = element_text(family = "Roboto"), axis.text = element_text(family = "Roboto"), strip.text = element_text(family = "Roboto"), axis.text.x = element_text(angle = 45, hjust = 1))

#si_knitr_settings()
options(scipen = 100) #this prevents numbers from showing up in scientific notation

```

<br>

`r include_graphics(path.expand("./template/SI_logo.png"))`

<br>

`r include_graphics(path.expand("./template/earth_map.jpeg"))`


#### A report prepared by the Sorenson Impact Center Data Science Team.



##### Pagebreak

```{r message=FALSE, warning=FALSE, include=FALSE}

datapath <- path_expand("G:/My Drive/SI/Current Projects/CRA Needs Assessment/WS 2_Analysis of Publicly Available Data/Data/")

wic <- read.csv("G:/My Drive/SI/Current Projects/CRA Needs Assessment/WS 2_Analysis of Publicly Available Data/Data/WIC_Clinics_in_Utah.csv") %>% clean_names()

poverty <- read.csv(path(datapath,"Poverty_data_by_Age__City_and_County_Utah_2013.csv")) %>% clean_names()

education <- read.csv(path(datapath, "Utah_Educational_Level_By_Census_Tract_2013.csv")) %>% clean_names()

hud <- read.csv(path(datapath, "County_HUD_Data_Utah_2011.csv")) %>% clean_names()

homelessness <- read.csv(path(datapath, "ut_homelessness.csv")) 

```

```{r wic, echo=FALSE, message=FALSE, warning=FALSE}

wic1 <- wic %>% separate(location_1, c("address","city1","geo"), sep = "\\n", remove = FALSE) %>% 
  separate(city1, c("city","state"), sep="\\,", remove = FALSE )

wic1 %>% 
  group_by(health_department) %>% 
  count() %>% 
  ggplot(aes(x = reorder(health_department,-n), y= n , fill = n)) +
  geom_bar(stat = "identity")+
  labs(title = " Distribution of WIC Clinics in Utah",
       x = "WIC Clinic Locations", y = "Count")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Create County dataset

pov_county <- poverty %>% 
  mutate(county1 = str_replace_all(county, '[ \t]+$', "")) %>% 
  mutate(county1 = case_when(county1 == "San Juabn"~"San Juan",
                             TRUE~county1))

pov_county %>% 
  group_by(county1) %>% 
  summarize(avg_median_income = mean(median_household_income, na.rm = TRUE)) %>% 
  ggplot(aes(x = reorder(county1, -avg_median_income), y = avg_median_income, fill = avg_median_income))+
  geom_bar(stat = "identity")+
  labs(title = "Average Median Income by County", x = "County", y = "Average Median Income")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_county %>%  
  group_by(county1) %>% 
  summarize(avg_gini_index = mean(gini_index, na.rm = TRUE)) %>% 
  ggplot(aes(x = reorder(county1, -avg_gini_index), y = avg_gini_index, fill = avg_gini_index))+
  geom_bar(stat = "identity")+
  labs(title = "Average Gini Index by County", x = "County", y = "Average Gini Index")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_county %>%  
  group_by(county1) %>% 
  summarize(avg_below_poverty_level = mean(below_poverty_level, na.rm = TRUE)) %>% 
  ggplot(aes(x = reorder(county1, -avg_below_poverty_level), y = avg_below_poverty_level, fill = avg_below_poverty_level))+
  geom_bar(stat = "identity")+
  labs(title = "Average Population Below Poverty Level by County", x = "County", y = "Average Population Below Poverty Level")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_county %>% 
  mutate(total_pop = below_poverty_level+ at_or_above_poverty_level) %>% 
  group_by(county1) %>% 
  summarise(tot_below_poverty = sum(below_poverty_level),
            tot_above_poverty = sum(at_or_above_poverty_level),
            agg_total_pop = sum(total_pop),
            poverty_rate = tot_below_poverty/agg_total_pop) %>% 
  ggplot(aes(x = reorder(county1, -poverty_rate), y = poverty_rate, fill = poverty_rate))+
  geom_bar(stat = "identity")+
  labs(title = "Average Poverty Rate by County", x = "County", y = "Average Poverty Rate")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

#Create City dataset

pov_city <- poverty %>% 
 separate(location_1, c("city1","geo"), sep = "\\(", remove = FALSE) %>% 
  separate(city1, c("city","state"), sep="\\,", remove = FALSE ) %>% 
  select(-city1)


pov_city %>% 
  arrange(desc(below_poverty_level)) %>% 
  slice(1:10) %>% 
  ggplot(aes(x = reorder(city, -below_poverty_level), y = below_poverty_level, fill = below_poverty_level))+
  geom_bar(stat = "identity")+
  labs(title = "Top 10 Cities with highest populations below poverty level",
       x = "City", y = "Population below poverty level")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_city %>% 
  mutate(total_pop = below_poverty_level+ at_or_above_poverty_level,
         poverty_rate = below_poverty_level/total_pop) %>% 
  arrange(desc(poverty_rate)) %>% 
  slice(1:10) %>% 
  ggplot(aes(x = reorder(city, -poverty_rate), y = poverty_rate, fill = poverty_rate))+
  geom_bar(stat = "identity")+
  labs(title = "Top 10 Cities with highest poverty rates",
       x = "City", y = "Poverty rates")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_city %>% 
  arrange(desc(gini_index)) %>% 
  slice(1:10) %>% 
  ggplot(aes(x = reorder(city, -gini_index), y = gini_index, fill = gini_index))+
  geom_bar(stat = "identity")+
  labs(title = "Top 10 Cities with highest Gini index",
       x = "City", y = "Gini Index")+
  scale_fill_gradient(low = "red", high = "darkred")

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_city %>% 
  arrange((gini_index)) %>% 
  slice(1:10) %>% 
  ggplot(aes(x = reorder(city, gini_index), y = gini_index, fill = gini_index))+
  geom_bar(stat = "identity")+
  labs(title = "Top 10 Cities with lowest Gini index",
       x = "City", y = "Gini Index")+
  scale_fill_gradient(low = "red", high = "darkred")

```



```{r echo=FALSE, message=FALSE, warning=FALSE}

pov_city %>% 
  mutate(total_pop = below_poverty_level+ at_or_above_poverty_level,
         poverty_rate = below_poverty_level/total_pop,
         total_below_poverty_males = below_poverty_level_male+at_or_above_poverty_level_male,
         total_below_poverty_females = below_poverty_level_female+at_or_above_poverty_level_female) %>%  
  arrange(desc(poverty_rate)) %>% 
  slice(1:10) %>% 
  select(city, total_below_poverty_males,total_below_poverty_females) %>% 
  rename(male = total_below_poverty_males,
         female = total_below_poverty_females) %>% 
  gather("sex","poverty_rates",2:3) %>% 
  ggplot(aes(x = city, y = poverty_rates, fill = sex))+
  geom_bar(stat = "identity", position = "dodge")+
  labs(title = "Distribution of poverty rates of males and females amongst the top 10 cities with highest poverty levels",
       x = "City", y = "Poverty rates")+
  scale_fill_manual(values = c("#CF3721","#31a9b8")) #(27.cheerfulbrights-color ref)

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```


```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```


```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

```{r echo=FALSE, message=FALSE, warning=FALSE}

```

